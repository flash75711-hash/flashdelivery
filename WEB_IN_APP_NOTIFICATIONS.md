# ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูุฏุงุฎููุฉ ููููุจ (In-App Notifications)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูููุฐ ูุธุงู ุฅุดุนุงุฑุงุช ุฏุงุฎูู (In-App) ูุนูู ุนูู ุงูููุจ ููุท ุจุฏูู Push Notifications. ูุณุชุฎุฏู ุงููุธุงู Supabase Realtime ููุงุณุชูุงุน ุฅูู ุชุบููุฑุงุช ุฌุฏูู ุงูุทูุจุงุช ูุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูุจุงุดุฑุฉ ูู ุงูุตูุญุฉ.

## โ ุงูููุฒุงุช

- **ุฅุดุนุงุฑุงุช ููุฑูุฉ**: ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูุจุงุดุฑุฉ ุนูุฏ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ ุฃู ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ
- **Web ููุท**: ูุนูู ุนูู ุงูููุจ ููุท - ุจุฏูู Push Notifications
- **ูุงุจู ููุชุจุฏูู**: ุชู ุชุตูููู ููููู ูุงุจูุงู ููุชุจุฏูู ุจู Push Notifications ูุงุญูุงู ุนูุฏ ุชุญูููู ุฅูู WebView App
- **ุจุณูุท ูููุธู**: ููุฏ ูุธูู ูููุธู ูุณูู ุงูุตูุงูุฉ

## ๐ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช

### ููุนููุงุก (Customers)

1. **ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ**: ุฅุดุนุงุฑ ูุฌุงุญ ุนูุฏ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
   - ุงูุนููุงู: "ุชู ุฅูุดุงุก ุงูุทูุจ ุจูุฌุงุญ"
   - ุงูุฑุณุงูุฉ: "ุชู ุฅูุดุงุก ุทูุจู ุจูุฌุงุญ. ุณูุชู ุงูุจุญุซ ุนู ุณุงุฆู ูุฑูุจ."

2. **ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ**:
   - **ููุจูู**: "ุชู ูุจูู ุทูุจู"
   - **ุชู ุงูุงุณุชูุงู**: "ุชู ุงุณุชูุงู ุงูุทูุจ"
   - **ููุฏ ุงูุชูุตูู**: "ุงูุทูุจ ููุฏ ุงูุชูุตูู"
   - **ููุชูู**: "ุชู ุฅููุงู ุงูุทูุจ"
   - **ููุบู**: "ุชู ุฅูุบุงุก ุงูุทูุจ"

### ููุณุงุฆููู (Drivers)

1. **ุทูุจ ุฌุฏูุฏ ูุชุงุญ**: ุฅุดุนุงุฑ ุนูุฏ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ (pending)
   - ุงูุนููุงู: "ุทูุจ ุฌุฏูุฏ ูุชุงุญ"
   - ุงูุฑุณุงูุฉ: "ุทูุจ ุฌุฏูุฏ ุจูููุฉ X ุฌ.ู"

2. **ุชู ุฅููุงู ุงูุทูุจ**: ุฅุดุนุงุฑ ุนูุฏ ุฅููุงู ุทูุจ
   - ุงูุนููุงู: "ุชู ุฅููุงู ุงูุทูุจ"
   - ุงูุฑุณุงูุฉ: "ุชู ุฅุถุงูุฉ X ุฌ.ู ุฅูู ูุญูุธุชู."

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### ุงููููุงุช ุงููุถุงูุฉ/ุงููุญุฏุซุฉ

1. **`hooks/useOrderNotifications.ts`** (ุฌุฏูุฏ)
   - Hook ููุงุณุชูุงุน ุฅูู ุชุบููุฑุงุช ุฌุฏูู `orders` ุจุงุณุชุฎุฏุงู Supabase Realtime
   - ูุนูู ุนูู ุงูููุจ ููุท (`Platform.OS === 'web'`)
   - ูุณุชูุน ุฅูู:
     - `INSERT`: ุฅูุดุงุก ุทูุจุงุช ุฌุฏูุฏุฉ
     - `UPDATE`: ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจุงุช

2. **`components/FloatingNotification.tsx`** (ูุญุฏุซ)
   - ุชุญุฏูุซ ุงูุชููู ุญุณุจ ุฏูุฑ ุงููุณุชุฎุฏู
   - ุงูุนููุงุก: `/customer/my-orders`
   - ุงูุณุงุฆููู: `/driver/trips`

3. **`app/(tabs)/_layout.tsx`** (ูุญุฏุซ)
   - ุฅุถุงูุฉ `useOrderNotifications` ูุนุฑุถ ุงูุฅุดุนุงุฑุงุช

4. **`lib/notifications.ts`** (ูุญุฏุซ)
   - ุชุนุทูู Push Notifications (Web ููุท)

## ๐ง ุงูุฅุนุฏุงุฏ

### 1. ุชูุนูู Supabase Realtime

ุชุฃูุฏ ูู ุชูุนูู Realtime ูุฌุฏูู `orders` ูู Supabase Dashboard:

1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู **Database** โ **Replication**
3. ูุนูู Realtime ูุฌุฏูู `orders`

ุฃู ุงุณุชุฎุฏู SQL:

```sql
-- ุชูุนูู Realtime ูุฌุฏูู orders
ALTER PUBLICATION supabase_realtime ADD TABLE orders;
```

### 2. ุงูุชุญูู ูู RLS Policies

ุชุฃูุฏ ูู ูุฌูุฏ RLS policies ููุงุณุจุฉ ูุฌุฏูู `orders` ููุณูุงุญ ูููุณุชุฎุฏููู ุจุงููุฑุงุกุฉ:

```sql
-- ููุนููุงุก: ูููููู ูุฑุงุกุฉ ุทูุจุงุชูู ููุท
CREATE POLICY "Customers can read own orders"
ON orders FOR SELECT
USING (auth.uid() = customer_id);

-- ููุณุงุฆููู: ูููููู ูุฑุงุกุฉ ุงูุทูุจุงุช ุงููุชุงุญุฉ ูุทูุจุงุชูู ุงูููุจููุฉ
CREATE POLICY "Drivers can read orders"
ON orders FOR SELECT
USING (
  driver_id IS NULL OR driver_id = auth.uid() OR 
  (status = 'pending' AND driver_id IS NULL)
);
```

## ๐ฏ ููููุฉ ุงูุนูู

1. **ุงูุงุณุชูุงุน**: `useOrderNotifications` ูุดุชุฑู ูู Realtime channel ูุฌุฏูู `orders`
2. **ุงููุดู**: ุนูุฏ ุญุฏูุซ `INSERT` ุฃู `UPDATE` ูู ุฌุฏูู `orders`
3. **ุงูุชุตููุฉ**: ูุชู ุชุตููุฉ ุงูุฃุญุฏุงุซ ุญุณุจ ุฏูุฑ ุงููุณุชุฎุฏู (`customer_id` ุฃู `driver_id`)
4. **ุงูุนุฑุถ**: ูุชู ุนุฑุถ ุงูุฅุดุนุงุฑ ุจุงุณุชุฎุฏุงู `FloatingNotification`
5. **ุงูุชููู**: ุนูุฏ ุงูุถุบุท ุนูู ุงูุฅุดุนุงุฑุ ูุชู ุงูุชููู ุฅูู ุงูุตูุญุฉ ุงูููุงุณุจุฉ

## ๐ ุงูุชุญููู ุฅูู Push Notifications (ูุงุญูุงู)

ุนูุฏ ุชุญููู ุงูุชุทุจูู ุฅูู WebView Appุ ูููู ุจุณูููุฉ ุฅุถุงูุฉ Push Notifications:

1. ุชูุนูู `sendPushNotification` ูู `lib/notifications.ts`
2. ุฅุถุงูุฉ ููุฏ ุชุณุฌูู Push Tokens
3. ุฅุถุงูุฉ Edge Function ูุฅุฑุณุงู Push Notifications
4. ุงููุธุงู ุงูุญุงูู ุณูุธู ูุนูู ูู fallback

## ๐ ููุงุญุธุงุช

- โ ูุนูู ุนูู ุงูููุจ ููุท (`Platform.OS === 'web'`)
- โ ูุง ูุณุชุฎุฏู Firebase, Web Push API, ุฃู Expo Notifications
- โ ูุณุชุฎุฏู Supabase Realtime ููุท
- โ ุจุณูุท ูููุธู ููุงุจู ููุตูุงูุฉ
- โ ูุงุจู ููุชุจุฏูู ูุงุญูุงู ุจู Push Notifications

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงูุฅุดุนุงุฑุงุช ูุง ุชุธูุฑ

1. ุชุฃูุฏ ูู ุชูุนูู Realtime ูุฌุฏูู `orders`
2. ุชุญูู ูู RLS policies
3. ุชุฃูุฏ ูู ูุฌูุฏ ุงุชุตุงู ุจู Supabase
4. ุชุญูู ูู Console ููุฃุฎุทุงุก

### ุงูุฅุดุนุงุฑุงุช ุชุธูุฑ ุฃูุซุฑ ูู ูุฑุฉ

- ุงููุธุงู ูุณุชุฎุฏู `shownOrderIds` ูุชุฌูุจ ุชูุฑุงุฑ ุงูุฅุดุนุงุฑุงุช
- ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุชุญูู ูู logic ูู `addNotification`

## ๐ ุงููุฑุงุฌุน

- [Supabase Realtime Documentation](https://supabase.com/docs/guides/realtime)
- [Supabase RLS Policies](https://supabase.com/docs/guides/auth/row-level-security)

