# ูุธุงู ุงููุตุงุฏูุฉ ุจุงุณุชุฎุฏุงู PIN - ููุฎุต ุงูุชูููุฐ

## โ ูุง ุชู ุฅูุฌุงุฒู

ุชู ุชุญููู ูุธุงู ุงููุตุงุฏูุฉ ุจุงููุงูู ูู OTP ุฅูู PIN ูุน ุฌููุน ุงููุชุทูุจุงุช:

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช โ
- โ ุฅุถุงูุฉ ุฃุนูุฏุฉ `pin_hash`, `failed_attempts`, `locked_until` ูู ุฌุฏูู `profiles`
- โ ุฅูุดุงุก indexes ููุจุญุซ ุงูุณุฑูุน
- โ ุฅูุดุงุก functions ูุฅุฏุงุฑุฉ failed_attempts
- โ ููู Migration: `pin_auth_migration.sql`

### 2. ูุณุชุฎุฏู Admin ุงูุชุฑุงุถู โ
- โ Edge Function: `supabase/functions/create-admin/index.ts`
- โ ุฑูู ุงูููุจุงูู: `01200006637`
- โ PIN: `000000`
- โ Role: `admin`
- โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู

### 3. ูุงุฌูุฉ ุชุณุฌูู ุงูุฏุฎูู โ
- โ ุฅุฏุฎุงู ุฑูู ุงูููุจุงูู
- โ 6 ุฎุงูุงุช PIN ูููุตูุฉ ูุน Auto-focus
- โ ุงูุชูุงู ุชููุงุฆู ุจูู ุงูุฎุงูุงุช
- โ ุฏุนู Paste ููุฃุฑูุงู ุงููุชุนุฏุฏุฉ
- โ ุงูุชุฒุงุฒ ุนูุฏ ุงูุฎุทุฃ/ุงููุฌุงุญ
- โ ุฑุณุงุฆู Toast ุฎูููุฉ (ูุง ุชุบุทู ุงูุดุงุดุฉ)

### 4. ูุงุฌูุฉ ุงูุชุณุฌูู โ
- โ ุงุฎุชูุงุฑ ููุน ุงูุญุณุงุจ (ุนููู/ุณุงุฆู/ูุฒูุฏ ุฎุฏูุฉ)
- โ ุฅุฏุฎุงู ุฑูู ุงูููุจุงูู
- โ ุฅูุดุงุก PIN (6 ุฃุฑูุงู)
- โ ุชุฃููุฏ PIN
- โ ุงูุชุญูู ูู ุชุทุงุจู PIN

### 5. ููุทู ุงูุชุญูู ูู PIN โ
- โ ุชุดููุฑ PIN ุจุงุณุชุฎุฏุงู bcrypt (10 rounds)
- โ ุงูุชุญูู ูู PIN ูุน hash
- โ ุฒูุงุฏุฉ failed_attempts ุนูุฏ ุงูุฎุทุฃ
- โ ููู ุงูุญุณุงุจ ุจุนุฏ 5 ูุญุงููุงุช ูุงุดูุฉ (30 ุฏูููุฉ)
- โ ุฅุนุงุฏุฉ ุชุนููู failed_attempts ุนูุฏ ุงููุฌุงุญ

### 6. Vibration API โ
- โ `vibrateError()` - ุงูุชุฒุงุฒ ุฎููู ููุฎุทุฃ
- โ `vibrateSuccess()` - ุงูุชุฒุงุฒ ูุตูุฑ ูููุฌุงุญ
- โ ุฏุนู Web Vibration API

### 7. SweetAlert2 Toast โ
- โ Toast ุฎููู (ูุง ูุบุทู ุงูุดุงุดุฉ)
- โ ููุถุน top-end
- โ timer progress bar
- โ ุฏุนู mouse hover ูุฅููุงู timer

### 8. ุตูุญุฉ ูุณูุงู PIN โ
- โ ุนุฑุถ ุฎูุงุฑุงุช ุงูุชูุงุตู (ุงุชุตุงู/ูุงุชุณุงุจ)
- โ ูุง ููุฌุฏ OTP ุฃู ุฅุนุงุฏุฉ ุชุนููู ุชููุงุฆู
- โ ูุงุฌูุฉ ูุธููุฉ ููุงุถุญุฉ

### 9. AuthContext โ
- โ ุฏุงูุฉ `loginWithPin()` ูุถุงูุฉ
- โ ุฏุนู ูุธุงู PIN ูู Context
- โ ุชุญุฏูุซ user state ูุจุงุดุฑุฉ

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ/ุงููุญุฏุซุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
- `lib/pinAuth.ts` - ููุทู ุงููุตุงุฏูุฉ ุจุงุณุชุฎุฏุงู PIN
- `lib/vibration.ts` - ูุธุงุฆู ุงูุงูุชุฒุงุฒ
- `components/PinInput.tsx` - ูููู ุฅุฏุฎุงู PIN
- `app/(auth)/forgot-pin.tsx` - ุตูุญุฉ ูุณูุงู PIN
- `pin_auth_migration.sql` - Migration script
- `supabase/functions/create-admin/index.ts` - Edge Function ูุฅูุดุงุก Admin
- `PIN_AUTH_SETUP.md` - ุฏููู ุงูุฅุนุฏุงุฏ
- `PIN_AUTH_README.md` - ูุฐุง ุงูููู

### ูููุงุช ูุญุฏุซุฉ:
- `app/(auth)/login.tsx` - ูุงุฌูุฉ ุชุณุฌูู ุงูุฏุฎูู ุงูุฌุฏูุฏุฉ
- `app/(auth)/register.tsx` - ูุงุฌูุฉ ุงูุชุณุฌูู ุงูุฌุฏูุฏุฉ
- `lib/alert.ts` - ุชุญุณูู Toast ููููู ุฎูููุงู
- `contexts/AuthContext.tsx` - ุฅุถุงูุฉ `loginWithPin()`

## ๐ ุฎุทูุงุช ุงูุจุฏุก

### 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ููุฐ ูู Supabase SQL Editor
-- ุงูุณุฎ ูุญุชูู pin_auth_migration.sql
```

### 2. ุฅูุดุงุก ูุณุชุฎุฏู Admin

#### ุฎูุงุฑ 1: Edge Function (ููุตู ุจู)
```bash
curl -X POST https://YOUR_PROJECT.supabase.co/functions/v1/create-admin \
  -H "Authorization: Bearer YOUR_SERVICE_ROLE_KEY"
```

#### ุฎูุงุฑ 2: ูุฏููุงู
- ุงุฐูุจ ุฅูู Supabase Dashboard > Authentication > Users
- ุฃูุดุฆ ูุณุชุฎุฏู ุฌุฏูุฏ
- ููุฐ SQL ูุชุญุฏูุซ profile

### 3. ุชุซุจูุช ุงูููุชุจุงุช

```bash
npm install bcryptjs @types/bcryptjs
```

### 4. ุงุฎุชุจุงุฑ ุงููุธุงู

1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฐูุจ ุฅูู ุชุณุฌูู ุงูุฏุฎูู
3. ุฃุฏุฎู: `01200006637` / `000000`
4. ูุฌุจ ุฃู ูุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ

## ๐ ุงูุฃูุงู

- โ PIN ูุดูุฑ ุจุงุณุชุฎุฏุงู bcrypt (10 rounds)
- โ ููู ุงูุญุณุงุจ ุจุนุฏ 5 ูุญุงููุงุช ูุงุดูุฉ
- โ ุฅุนุงุฏุฉ ุชุนููู failed_attempts ุนูุฏ ุงููุฌุงุญ
- โ ูู ุงูููู ุงูุชููุงุฆู ุจุนุฏ 30 ุฏูููุฉ

## ๐ฑ ุงูููุฒุงุช

### ูุงุฌูุฉ ุงููุณุชุฎุฏู
- โ 6 ุฎุงูุงุช PIN ูููุตูุฉ
- โ Auto-focus ุชููุงุฆู
- โ ุงูุชูุงู ุณูุณ ุจูู ุงูุฎุงูุงุช
- โ ุฏุนู Paste
- โ ุชุตููู responsive

### ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- โ ุงูุชุฒุงุฒ ุฎููู ุนูุฏ ุงูุฎุทุฃ
- โ ุงูุชุฒุงุฒ ูุตูุฑ ุนูุฏ ุงููุฌุงุญ
- โ ุฑุณุงุฆู Toast ุฎูููุฉ (ูุง ุชุบุทู ุงูุดุงุดุฉ)
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ ุนุฑุถ ูุญุงููุงุช ูุชุจููุฉ

## ๐ฏ ุงูุงุณุชุฎุฏุงู

### ุชุณุฌูู ุงูุฏุฎูู
```typescript
import { loginWithPin } from '@/lib/pinAuth';

const result = await loginWithPin('01200006637', '000000');
if (result.success) {
  // ุชุณุฌูู ุงูุฏุฎูู ูุฌุญ
  console.log(result.user);
}
```

### ุงูุชุณุฌูู
```typescript
import { registerWithPin } from '@/lib/pinAuth';

const result = await registerWithPin('01234567890', '123456', 'customer');
if (result.success) {
  // ุงูุชุณุฌูู ูุฌุญ
}
```

### ุงูุงูุชุฒุงุฒ
```typescript
import { vibrateError, vibrateSuccess } from '@/lib/vibration';

vibrateError(); // ุนูุฏ ุงูุฎุทุฃ
vibrateSuccess(); // ุนูุฏ ุงููุฌุงุญ
```

### Toast
```typescript
import { showToast } from '@/lib/alert';

showToast('ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ', 'success');
showToast('ุฑูุฒ PIN ุบูุฑ ุตุญูุญ', 'error');
```

## ๐ ููุงุญุธุงุช ูููุฉ

1. **Supabase Auth**: ุงููุธุงู ูุณุชุฎุฏู Supabase Auth ูุฅูุดุงุก usersุ ููู ุงููุตุงุฏูุฉ ุงููุนููุฉ ุชุชู ุนุจุฑ PIN ูู ุฌุฏูู profiles.

2. **Session Management**: ูู ูุธุงู PINุ ูุฏ ูุง ูููู ููุงู session ูู Supabase Auth. ูุชู ุงุณุชุฎุฏุงู user ูุจุงุดุฑุฉ ูู profiles.

3. **Phone Format**: ุฌููุน ุฃุฑูุงู ุงูููุจุงูู ูุชู ุชูุณูููุง ุชููุงุฆูุงู ุฅูู `+20xxxxxxxxxx`.

4. **Vibration**: ูุนูู ููุท ุนูู ุงูุฃุฌูุฒุฉ ุงูุชู ุชุฏุนู Web Vibration API (ูุนุธู ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ).

5. **bcrypt**: ูุณุชุฎุฏู bcryptjs (ูุณุฎุฉ JavaScript) ููุชุดููุฑ.

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: "ุฑูู ุงูููุจุงูู ุบูุฑ ูุณุฌู"
- ุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูู ุฌุฏูู profiles
- ุชุญูู ูู ุชูุณูู ุฑูู ุงูููุจุงูู

### ุฎุทุฃ: "ุฑูุฒ PIN ุบูุฑ ุตุญูุญ"
- ุชุญูู ูู ุฃู PIN hash ุตุญูุญ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู bcrypt ููุชุดููุฑ

### ุฎุทุฃ: "ุงูุญุณุงุจ ูููู ูุคูุชุงู"
- ุงูุชุธุฑ 30 ุฏูููุฉ
- ุฃู ุฃุนุฏ ุชุนููู `failed_attempts` ู `locked_until` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## โจ ุงูููุฒุงุช ุงููุณุชูุจููุฉ (ุงุฎุชูุงุฑูุฉ)

- [ ] ุฅุนุงุฏุฉ ุชุนููู PIN ุชููุงุฆูุงู ุนุจุฑ SMS
- [ ] Two-Factor Authentication
- [ ] ุณุฌู ูุญุงููุงุช ุชุณุฌูู ุงูุฏุฎูู
- [ ] ุฅุดุนุงุฑุงุช ุนูุฏ ููู ุงูุญุณุงุจ
- [ ] ุชุบููุฑ PIN ูู ุฏุงุฎู ุงูุชุทุจูู

## ๐ ุงููุซุงุฆู

- `PIN_AUTH_SETUP.md` - ุฏููู ุงูุฅุนุฏุงุฏ ุงูุชูุตููู
- `pin_auth_migration.sql` - Migration script ูุน ุงูุชูุซูู
- ุงูููุฏ ููุซู ุจุงููุงูู ูุน comments

---

**ุชู ุงูุชูููุฐ ุจูุฌุงุญ! ๐**

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู. ุงุชุจุน ุฎุทูุงุช ุงูุฅุนุฏุงุฏ ูู `PIN_AUTH_SETUP.md` ููุจุฏุก.

