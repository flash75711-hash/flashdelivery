# ๐ ูุดุฑ Edge Function: add-to-driver-wallet (ูุญุฏุซ)

## ุงูุชุญุฏูุซุงุช ุงููุถุงูุฉ:
โ ุญุณุงุจ ุงูุนูููุฉ ูู ุญุณุงุจ ุงููุดูุงุฑ ููุท ูููุณ ูู ุงูุญุณุงุจ ุงูููู  
โ ุฅุถุงูุฉ ูุนุงููุงุช `deliveryFee` ู `itemsFee` ูููุตููู  
โ ุชุญุณูู logging ูุชูุถูุญ ุงูุญุณุงุจ  

## ุทุฑููุฉ ุงููุดุฑ:

### ุงูุทุฑููุฉ 1: ูู Supabase Dashboard (ุงูุฃุณูู) โ

1. **ุงูุชุญ Supabase Dashboard**
   - ุงุฐูุจ ุฅูู: https://supabase.com/dashboard/project/tnwrmybyvimlsamnputn/functions

2. **ุงุจุญุซ ุนู Edge Function `add-to-driver-wallet`**
   - ุฅุฐุง ูุงู ููุฌูุฏุงูุ ุงุถุบุท ุนููู
   - ุฅุฐุง ูู ููู ููุฌูุฏุงูุ ุงุถุบุท ุนูู **"Create a new function"** ูุงุณูู `add-to-driver-wallet`

3. **ูุณุฎ ุงูููุฏ ุงููุญุฏุซ**
   - ุงูุชุญ ุงูููู: `supabase/functions/add-to-driver-wallet/index.ts`
   - ุงูุณุฎ ูู ุงููุญุชูู
   - ุงูุตูู ูู ูุญุฑุฑ ุงูููุฏ ูู Dashboard

4. **ุชุฃูุฏ ูู ุงูุฅุนุฏุงุฏุงุช**
   - **Verify JWT**: โ ููุนูู (checked)
   - ูุฐุง ููู ูุฃู Function ูุญุชุงุฌ ููุชุญูู ูู ูููุฉ ุงูุณุงุฆู

5. **ุงููุดุฑ**
   - ุงุถุบุท ุนูู **Deploy** ุฃู **Save**

### ุงูุทุฑููุฉ 2: ูู Terminal (ูุชุทูุจ token)

```bash
# 1. ุชุนููู Access Token
export SUPABASE_ACCESS_TOKEN=your_access_token_here

# 2. ูุดุฑ Edge Function
cd /home/zero/Desktop/flash
npx supabase functions deploy add-to-driver-wallet --project-ref tnwrmybyvimlsamnputn --verify-jwt
```

**ููุญุตูู ุนูู Access Token:**
- ุงุฐูุจ ุฅูู: https://supabase.com/dashboard/account/tokens
- ุฃูุดุฆ token ุฌุฏูุฏ ุฃู ุงุณุชุฎุฏู token ููุฌูุฏ

## ุงูุชุญูู ูู ุงููุดุฑ:

1. **ูู Dashboard**
   - ุงุฐูุจ ุฅูู Edge Functions
   - ุชุฃูุฏ ูู ูุฌูุฏ `add-to-driver-wallet` ูู ุงููุงุฆูุฉ
   - ุชุฃูุฏ ูู ุฃู ุงูุญุงูุฉ: **Active**
   - ุชุญูู ูู ุขุฎุฑ ุชุญุฏูุซ (ูุฌุจ ุฃู ูููู ุงูุขู)

2. **ุงุฎุชุจุงุฑ Function**
   - ุงุถุบุท ุนูู `add-to-driver-wallet`
   - ุงุฎุชุฑ **Invoke function**
   - ุงุณุชุฎุฏู ูุฐุง ุงูู Body:
     ```json
     {
       "driverId": "uuid-here",
       "amount": 100,
       "orderId": "uuid-here",
       "deliveryFee": 50,
       "itemsFee": 30
     }
     ```

## ๐ ูุซุงู ุนูู ุงูุญุณุงุจ ุงูุฌุฏูุฏ:

**ูุจู ุงูุชุนุฏูู:**
- ุญุณุงุจ ุงููุดูุงุฑ: 50 ุฌููู
- ุญุณุงุจ ุงูุนูุงุตุฑ: 30 ุฌููู
- ุงูุญุณุงุจ ุงูููู: 80 ุฌููู
- ุงูุนูููุฉ (10%): 8 ุฌููู (ูู 80)
- ุงูุณุงุฆู ูุญุตู: 72 ุฌููู

**ุจุนุฏ ุงูุชุนุฏูู:**
- ุญุณุงุจ ุงููุดูุงุฑ: 50 ุฌููู
- ุญุณุงุจ ุงูุนูุงุตุฑ: 30 ุฌููู
- ุงูุญุณุงุจ ุงูููู: 80 ุฌููู
- ุงูุนูููุฉ (10%): 5 ุฌููู (ูู 50 ููุท - ุญุณุงุจ ุงููุดูุงุฑ)
- ุงูุณุงุฆู ูุญุตู: (50 - 5) + 30 = 75 ุฌููู

**ุงููุฑู:** ุงูุณุงุฆู ูุญุตู ุนูู 3 ุฌููู ุฅุถุงููุฉ ูุฃู ุงูุนูููุฉ ุชูุญุณุจ ูู ุญุณุงุจ ุงููุดูุงุฑ ููุท! โ
