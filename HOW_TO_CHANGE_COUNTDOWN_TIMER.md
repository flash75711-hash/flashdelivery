# ⏱️ كيفية التحكم في مدة الشريط الزمني من الإدارة

## ✅ الإعداد موجود بالفعل وجاهز للاستخدام!

---

## 📋 معلومات الإعداد:

| البيان | القيمة |
|--------|--------|
| **المفتاح** | `driver_response_timeout` |
| **القيمة الحالية** | 300 ثانية |
| **التحويل** | 5 دقائق |
| **الوصف** | مدة انتظار رد السائق بالثواني |
| **الفئة** | orders (الطلبات) |
| **النوع** | number (رقم) |
| **الموقع** | صفحة الإعدادات في الإدارة ✅ |

---

## 🚀 كيفية الوصول والتعديل:

### الطريقة 1️⃣: من واجهة الإدارة (الأسهل)

#### الخطوة 1: سجل دخول كمدير
```
http://localhost:8081
```

#### الخطوة 2: اذهب لصفحة الإعدادات
انقر على تبويب **"⚙️ الإعدادات"** في شريط التنقل السفلي

أو مباشرة:
```
http://localhost:8081/(tabs)/admin/settings
```

#### الخطوة 3: ابحث عن الإعداد
ستجد قسم **"الطلبات (orders)"** يحتوي على:

```
╔════════════════════════════════════════╗
║ 📦 الطلبات (Orders)                   ║
╠════════════════════════════════════════╣
║                                        ║
║ مدة انتظار رد السائق بالثواني         ║
║ driver_response_timeout                ║
║ ┌────────────────────────────────┐    ║
║ │ 300                            │ ← أدخل القيمة بالثواني
║ └────────────────────────────────┘    ║
║                                        ║
║ عدد محاولات إعادة الإرسال التلقائية   ║
║ max_auto_retry_attempts                ║
║ ┌────────────────────────────────┐    ║
║ │ 3                              │    ║
║ └────────────────────────────────┘    ║
║                                        ║
║ الفاصل الزمني بين كل محاولة (بالثواني)║
║ retry_interval                         ║
║ ┌────────────────────────────────┐    ║
║ │ 30                             │    ║
║ └────────────────────────────────┘    ║
║                                        ║
╠════════════════════════════════════════╣
║  [💾 حفظ التغييرات]  [🔄 إعادة تعيين] ║
╚════════════════════════════════════════╝
```

#### الخطوة 4: غيّر القيمة
- **القيمة الحالية:** 300 ثانية (5 دقائق)
- **أمثلة:**
  - 60 = دقيقة واحدة
  - 120 = دقيقتان
  - 180 = 3 دقائق
  - 300 = 5 دقائق (الحالية)
  - 600 = 10 دقائق
  - 900 = 15 دقيقة

#### الخطوة 5: احفظ
اضغط زر **"💾 حفظ التغييرات"**

---

### الطريقة 2️⃣: من SQL مباشرة (للمطورين)

```sql
-- عرض القيمة الحالية
SELECT 
  setting_value as "القيمة الحالية (ثانية)",
  FLOOR(setting_value::INT / 60) || ' دقيقة' as التحويل
FROM app_settings
WHERE setting_key = 'driver_response_timeout';

-- تغيير إلى دقيقة واحدة (60 ثانية)
UPDATE app_settings 
SET setting_value = '60'
WHERE setting_key = 'driver_response_timeout';

-- تغيير إلى 3 دقائق (180 ثانية)
UPDATE app_settings 
SET setting_value = '180'
WHERE setting_key = 'driver_response_timeout';

-- تغيير إلى 10 دقائق (600 ثانية)
UPDATE app_settings 
SET setting_value = '600'
WHERE setting_key = 'driver_response_timeout';

-- إعادة للقيمة الافتراضية (5 دقائق)
UPDATE app_settings 
SET setting_value = '300'
WHERE setting_key = 'driver_response_timeout';
```

---

## 📊 أمثلة القيم الشائعة:

| المدة | القيمة بالثواني | متى تستخدم؟ |
|-------|-----------------|-------------|
| **30 ثانية** | 30 | للاختبار السريع فقط ⚠️ |
| **1 دقيقة** | 60 | للاختبار/طلبات سريعة جداً |
| **2 دقيقة** | 120 | مناطق مزدحمة/سائقين كثيرين |
| **3 دقائق** | 180 | توازن جيد |
| **5 دقائق** | 300 | **الافتراضي** ✅ (موصى به) |
| **10 دقائق** | 600 | مناطق واسعة/سائقين قليلين |
| **15 دقيقة** | 900 | مناطق نائية/أوقات الذروة |

---

## 🧪 اختبار التغيير:

### بعد تغيير القيمة:

1. **أنشئ طلباً جديداً:**
   ```
   http://localhost:8081/orders/deliver-package
   ```

2. **ستظهر المدة الجديدة في الشريط:**
   - إذا غيرت إلى 60 ثانية:
     ```
     ⏱️ 01:00 (دقيقة واحدة)
     ```
   - إذا غيرت إلى 180 ثانية:
     ```
     ⏱️ 03:00 (3 دقائق)
     ```
   - إذا غيرت إلى 600 ثانية:
     ```
     ⏱️ 10:00 (10 دقائق)
     ```

3. **التحقق من قاعدة البيانات:**
   ```sql
   SELECT 
     id,
     driver_response_deadline,
     created_at,
     EXTRACT(EPOCH FROM (driver_response_deadline - created_at)) as seconds_duration
   FROM orders 
   ORDER BY created_at DESC 
   LIMIT 1;
   ```

---

## ⚠️ ملاحظات مهمة:

### 1. التأثير على الطلبات:

- ✅ **الطلبات الجديدة:** تتأثر فوراً
- ❌ **الطلبات القديمة:** لا تتأثر (لها deadline محفوظ بالفعل)

### 2. نصائح:

- ⚠️ **لا تجعلها قصيرة جداً:** أقل من 60 ثانية قد يكون قصيراً جداً للسائقين
- ✅ **القيمة الموصى بها:** 180-300 ثانية (3-5 دقائق)
- 🔄 **مع auto-retry:** إذا كانت لديك إعادة محاولات تلقائية، احسب الوقت الإجمالي:
  ```
  إجمالي الوقت = driver_response_timeout × (max_auto_retry_attempts + 1)
  
  مثال:
  300 ثانية × (3 + 1) = 1200 ثانية = 20 دقيقة إجمالي
  ```

### 3. تأثير على تجربة المستخدم:

| القيمة | التجربة |
|-------|---------|
| **قصيرة جداً (<60)** | 😞 محبطة - لا وقت كاف للسائقين |
| **قصيرة (60-120)** | 😐 مقبولة - للمناطق المزدحمة فقط |
| **متوسطة (180-300)** | 😊 **مثالية** - توازن جيد |
| **طويلة (>600)** | 😴 ممل - انتظار طويل للعميل |

---

## 🔗 الإعدادات المرتبطة:

### إعدادات تعمل معاً:

1. **driver_response_timeout** (هذا الإعداد)
   - مدة انتظار رد السائق
   - يظهر في الشريط الأخضر المرئي

2. **max_auto_retry_attempts**
   - عدد المحاولات التلقائية
   - القيمة الحالية: 3

3. **retry_interval**
   - الفاصل بين كل محاولة
   - القيمة الحالية: 30 ثانية

**الحساب الإجمالي:**
```
الوقت الكلي = driver_response_timeout × (max_auto_retry_attempts + 1)
             = 300 × (3 + 1)
             = 1200 ثانية
             = 20 دقيقة
```

---

## 📸 لقطات الشاشة المتوقعة:

### في صفحة الإعدادات:

```
════════════════════════════════════════
⚙️ إعدادات التطبيق
════════════════════════════════════════

📦 الطلبات (Orders)
────────────────────────────────────────

مدة انتظار رد السائق بالثواني
driver_response_timeout

┌──────────────────────────────────┐
│ 300                          معدل │ ← إذا عدلت
└──────────────────────────────────┘

عدد محاولات إعادة الإرسال التلقائية
max_auto_retry_attempts

┌──────────────────────────────────┐
│ 3                                │
└──────────────────────────────────┘

────────────────────────────────────────
[💾 حفظ التغييرات]  [🔄 إعادة تعيين]
════════════════════════════════════════
```

### في الشريط الزمني بعد التغيير:

إذا غيرت إلى **60 ثانية**:
```
╔════════════════════════════════════════╗
║ 📦 توصيل طرد         ⏸️ قيد الانتظار   ║
║─────────────────────────────────────║
║ ⏱️ 00:58                             ║  ← دقيقة واحدة!
║ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░       ║
║ الرد خلال 58 ثانية                  ║
╚════════════════════════════════════════╝
```

إذا غيرت إلى **600 ثانية**:
```
╔════════════════════════════════════════╗
║ 📦 توصيل طرد         ⏸️ قيد الانتظار   ║
║─────────────────────────────────────║
║ ⏱️ 09:58                             ║  ← 10 دقائق!
║ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓       ║
║ الرد خلال 598 ثانية                 ║
╚════════════════════════════════════════╝
```

---

## 🎯 الخلاصة:

✅ **نعم! يمكنك التحكم في مدة الشريط الزمني من الإدارة بالثواني**

### الطريقة:
1. سجل دخول كمدير
2. اذهب لتبويب "⚙️ الإعدادات"
3. ابحث عن "مدة انتظار رد السائق بالثواني"
4. غيّر القيمة (بالثواني)
5. احفظ التغييرات

### الرابط المباشر:
```
http://localhost:8081/(tabs)/admin/settings
```

---

**✅ الإعداد موجود وجاهز! جرّبه الآن!** 🎉⏱️











