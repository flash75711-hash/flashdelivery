# ๐ ุฏููู ููุฒุฉ "ุฅุนุงุฏุฉ ุงูุทูุจ" (Reorder)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ููุฒุฉ **"ุฅุนุงุฏุฉ ุงูุทูุจ ูุฑุฉ ุฃุฎุฑู"** ุชุณูุญ ููุนููู ุจุฅุนุงุฏุฉ ุทูุจ ููุณ ุงูุทูุจ ุงูุณุงุจู ุจุถุบุทุฉ ุฒุฑ ูุงุญุฏุฉุ ุฏูู ุงูุญุงุฌุฉ ูุฅุฏุฎุงู ุฌููุน ุงูุชูุงุตูู ูู ุฌุฏูุฏ.

---

## โจ ุงููููุฒุงุช

### 1๏ธโฃ ุณูููุฉ ุงูุงุณุชุฎุฏุงู
- โ ุฒุฑ ูุงุญุฏ ูู ุตูุญุฉ ุชูุงุตูู ุงูุทูุจ
- โ ูุณุฎ ุชููุงุฆู ูุฌููุน ุจูุงูุงุช ุงูุทูุจ
- โ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ ุจุซูุงูู

### 2๏ธโฃ ุงูุฃูุงู
- โ ูุธูุฑ ููุท ููุนููู (ุตุงุญุจ ุงูุทูุจ)
- โ ูุนูู ููุท ูุน ุงูุทูุจุงุช ุงูููุชููุฉ ุฃู ุงูููุบุงุฉ
- โ ุชุฃููุฏ ูุจู ุงูุฅูุดุงุก

### 3๏ธโฃ ุงูุฐูุงุก
- โ ูุญุณุจ `driver_response_deadline` ุฌุฏูุฏ ุชููุงุฆูุงู
- โ ููุณุฎ ุฌููุน ุงูุชูุงุตูู (ุงูุนูุงูููุ ุงูุณุนุฑุ ุงูููุนุ ุฅูุฎ)
- โ ูุฑุณู ุฅุดุนุงุฑุงุช ูุฌููุน ุงูุณุงุฆููู

---

## ๐ฏ ูุชู ูุธูุฑ ุงูุฒุฑุ

| ุงูุดุฑุท | ุงููููุฉ | ุงูุญุงูุฉ |
|-------|--------|--------|
| **ุงููุณุชุฎุฏู** | ุนููู (customer) | โ ูุธูุฑ |
| **ุงููุณุชุฎุฏู** | ุณุงุฆู/ูุฏูุฑ | โ ูุง ูุธูุฑ |
| **ุญุงูุฉ ุงูุทูุจ** | ููุชูู (completed) | โ ูุธูุฑ |
| **ุญุงูุฉ ุงูุทูุจ** | ููุบู (cancelled) | โ ูุธูุฑ |
| **ุญุงูุฉ ุงูุทูุจ** | ููุฏ ุงูุงูุชุธุงุฑ (pending) | โ ูุง ูุธูุฑ |
| **ุญุงูุฉ ุงูุทูุจ** | ููุจูู (accepted) | โ ูุง ูุธูุฑ |

---

## ๐ ุงููููุงุช ุงููุนุฏููุฉ

### 1. `app/orders/[id].tsx`

**ุงูุชุนุฏููุงุช:**
```typescript
// 1. ุฅุถุงูุฉ state ููู loading
const [reordering, setReordering] = useState(false);

// 2. ุฏุงูุฉ handleReorder
const handleReorder = async () => {
  // ุชุฃููุฏ ูู ุงููุณุชุฎุฏู
  // ูุณุฎ ุจูุงูุงุช ุงูุทูุจ
  // ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
  // ุฅุฑุณุงู ุฅุดุนุงุฑุงุช
  // ุชูุฌูู ููุทูุจ ุงูุฌุฏูุฏ
};

// 3. ุดุฑุท ุนุฑุถ ุงูุฒุฑ
const canReorder = isCustomer && (order.status === 'completed' || order.status === 'cancelled');

// 4. ุฒุฑ "ุฅุนุงุฏุฉ ุงูุทูุจ"
{canReorder && (
  <TouchableOpacity
    style={styles.reorderButton}
    onPress={handleReorder}
    disabled={reordering}
  >
    {reordering ? (
      <ActivityIndicator color="#fff" />
    ) : (
      <>
        <Ionicons name="repeat" size={20} color="#fff" />
        <Text style={styles.reorderButtonText}>ุฅุนุงุฏุฉ ุงูุทูุจ ูุฑุฉ ุฃุฎุฑู</Text>
      </>
    )}
  </TouchableOpacity>
)}
```

---

## ๐ ุขููุฉ ุงูุนูู

### ุงูุฎุทูุฉ 1: ุงูุนููู ูุถุบุท ุนูู "ุฅุนุงุฏุฉ ุงูุทูุจ"

```
๐ฑ ุตูุญุฉ ุชูุงุตูู ุงูุทูุจ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ฆ ุชูุตูู ุทุฑุฏ         โ ููุชูู          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ช ูู: ูุญู ุงูุนุฒุจู                    โ
โ ๐ ุฅูู: ููุชุงูู                      โ
โ ๐ฐ ุงูุฃุฌุฑุฉ: 150 ุฌ.ู                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  [๐ ุฅุนุงุฏุฉ ุงูุทูุจ ูุฑุฉ ุฃุฎุฑู]         โ  โ ุงูุฒุฑ ุงูุฌุฏูุฏ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุงูุฎุทูุฉ 2: ุชุฃููุฏ ูู ุงููุณุชุฎุฏู

```javascript
// Web: window.confirm
ูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุทูุจ ูุฐุง ุงูุทูุจ ูุฑุฉ ุฃุฎุฑูุ
[ุฅูุบุงุก]  [ูุนูุ ุฅุนุงุฏุฉ ุงูุทูุจ]

// Mobile: Alert.alert
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         ุฅุนุงุฏุฉ ุงูุทูุจ                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุทูุจ ูุฐุง ุงูุทูุจ       โ
โ ูุฑุฉ ุฃุฎุฑูุ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ    [ุฅูุบุงุก]  [ูุนูุ ุฅุนุงุฏุฉ ุงูุทูุจ]    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุงูุฎุทูุฉ 3: ูุณุฎ ุงูุจูุงูุงุช

```typescript
const newOrderData = {
  customer_id: user.id,                    // โ ูุนุฑู ุงูุนููู
  order_type: order.order_type,            // โ ููุน ุงูุทูุจ
  pickup_address: order.pickup_address,    // โ ุนููุงู ุงูุงุณุชูุงู
  delivery_address: order.delivery_address,// โ ุนููุงู ุงูุชูุตูู
  package_description: order.items?.package_description,
  total_fee: order.total_fee,              // โ ุงูุฃุฌุฑุฉ
  status: 'pending',                       // ๐ ุฌุฏูุฏ
  search_status: 'searching',              // ๐ ุจุญุซ ุนู ุณุงุฆู
  driver_response_deadline: newDeadline,   // ๐ ููุช ุฌุฏูุฏ
  retry_count: 0,                          // ๐ ุจุฏูู ูุญุงููุงุช
  items: order.items,                      // โ ุงูุนูุงุตุฑ
};
```

### ุงูุฎุทูุฉ 4: ุฅูุดุงุก ุงูุทูุจ ุงูุฌุฏูุฏ

```typescript
const { data: newOrder, error } = await supabase
  .from('orders')
  .insert([newOrderData])
  .select()
  .single();
```

### ุงูุฎุทูุฉ 5: ุฅุฑุณุงู ุฅุดุนุงุฑุงุช

```typescript
await createNotification({
  user_id: null, // โ ุฌููุน ุงูุณุงุฆููู
  title: '๐ฆ ุทูุจ ุฌุฏูุฏ',
  message: `ุทูุจ ุชูุตูู ุฌุฏูุฏ ุจูููุฉ 150 ุฌ.ู`,
  type: 'order',
  order_id: newOrder.id,
});
```

### ุงูุฎุทูุฉ 6: ุฑุณุงูุฉ ูุฌุงุญ ูุชูุฌูู

**ุนูู ุงูููุจ:**
```javascript
alert('โ ุชู ุฅุนุงุฏุฉ ุงูุทูุจ ุจูุฌุงุญ! ุฌุงุฑู ุงูุจุญุซ ุนู ุณุงุฆู...');
router.replace(`/orders/${newOrder.id}`);
```

**ุนูู ุงูููุจุงูู:**
```javascript
Alert.alert(
  'ูุฌุญ',
  'ุชู ุฅุนุงุฏุฉ ุงูุทูุจ ุจูุฌุงุญ! ุฌุงุฑู ุงูุจุญุซ ุนู ุณุงุฆู...',
  [
    { text: 'ุนุฑุถ ุงูุทูุจ ุงูุฌุฏูุฏ', onPress: () => router.replace(`/orders/${newOrder.id}`) },
    { text: 'ุงูุนูุฏุฉ ูุทูุจุงุชู', onPress: () => router.replace('/(tabs)/customer/my-orders') },
  ]
);
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### 1. ุฅูุดุงุก ุทูุจ ุงุฎุชุจุงุฑ ูุฅููุงูู:

```sql
-- ุฅูุดุงุก ุทูุจ
INSERT INTO orders (
  id, customer_id, order_type, pickup_address, delivery_address,
  total_fee, status, created_at
)
SELECT 
  gen_random_uuid(),
  id,
  'package',
  '๐ช ูุญู ุงูุณุนุงุฏุฉ',
  '๐ ููุฒู ุงูุนููู',
  150.00,
  'completed',
  NOW()
FROM profiles 
WHERE role = 'customer' 
LIMIT 1;
```

### 2. ุงูุชุญ ุชูุงุตูู ุงูุทูุจ:

```
http://localhost:8081/orders/[ุงูุทูุจ_id]
```

### 3. ูุฌุจ ุฃู ุชุฑู:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ฆ ุชูุตูู ุทุฑุฏ         โ ููุชูู          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ช ูู: ูุญู ุงูุณุนุงุฏุฉ                   โ
โ ๐ ุฅูู: ููุฒู ุงูุนููู                  โ
โ ๐ฐ ุงูุฃุฌุฑุฉ: 150 ุฌ.ู                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  [๐ ุฅุนุงุฏุฉ ุงูุทูุจ ูุฑุฉ ุฃุฎุฑู]         โ  โ ููุง!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 4. ุงุถุบุท ุนูู ุงูุฒุฑ:

```javascript
// ูู Console:
๐ [Reorder] ุจุฏุก ุฅุนุงุฏุฉ ุงูุทูุจ: abc123
๐ฆ [Reorder] ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ ุจููุณ ุงูุจูุงูุงุช...
โ [Reorder] ุชู ุฅูุดุงุก ุงูุทูุจ ุงูุฌุฏูุฏ: xyz789

// ูู ุงููุงุฌูุฉ:
โ ุชู ุฅุนุงุฏุฉ ุงูุทูุจ ุจูุฌุงุญ! ุฌุงุฑู ุงูุจุญุซ ุนู ุณุงุฆู...
```

### 5. ุชุญูู ูู ุงูุทูุจ ุงูุฌุฏูุฏ:

```sql
SELECT 
  id,
  order_type,
  pickup_address,
  delivery_address,
  total_fee,
  status,
  search_status,
  driver_response_deadline,
  retry_count
FROM orders 
ORDER BY created_at DESC 
LIMIT 2;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
| id      | order_type | status    | search_status | retry_count |
|---------|------------|-----------|---------------|-------------|
| xyz789  | package    | pending   | searching     | 0           | โ ุฌุฏูุฏ
| abc123  | package    | completed | stopped       | 0           | โ ูุฏูู
```

---

## ๐ ุงูููุงุฆุฏ

### ููุนููู:
- โ **ุชูููุฑ ุงูููุช**: ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุฅุฏุฎุงู ุงูุจูุงูุงุช
- โ **ุณูููุฉ ุงูุงุณุชุฎุฏุงู**: ุฒุฑ ูุงุญุฏ ููุท
- โ **ุฏูุฉ ุงูุจูุงูุงุช**: ููุณ ุงูุนูุงููู ูุงูุชูุงุตูู

### ููุณุงุฆููู:
- โ **ุทูุจุงุช ุฌุฏูุฏุฉ**: ุงููุฒูุฏ ูู ูุฑุต ุงูุนูู
- โ **ุฅุดุนุงุฑุงุช ููุฑูุฉ**: ูุชู ุฅุฎุทุงุฑูู ููุฑุงู

### ูููุธุงู:
- โ **ุฒูุงุฏุฉ ุงูุทูุจุงุช**: ุชุดุฌูุน ุฅุนุงุฏุฉ ุงูุทูุจ
- โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู**: UX ูุญุณูู
- โ **ุชูููู ุงูุฃุฎุทุงุก**: ูุณุฎ ุฏููู ููุจูุงูุงุช

---

## ๐จ ุชุตููู ุงูุฒุฑ

### ุงูุฃููุงู:
- **ุฎูููุฉ**: `#007AFF` (ุฃุฒุฑู iOS)
- **ูุต**: `#fff` (ุฃุจูุถ)
- **ุฃููููุฉ**: `repeat` ูู Ionicons

### ุงูุฃููุงุท:
```typescript
reorderButton: {
  flexDirection: 'row',
  alignItems: 'center',
  justifyContent: 'center',
  backgroundColor: '#007AFF',
  borderRadius: 12,
  padding: 16,
  marginTop: 16,
  gap: 8,
  shadowColor: '#007AFF',
  shadowOffset: { width: 0, height: 2 },
  shadowOpacity: 0.3,
  shadowRadius: 4,
  elevation: 3,
},
```

### ุงูุญุงูุงุช:
```typescript
// ุนุงุฏู
[๐ ุฅุนุงุฏุฉ ุงูุทูุจ ูุฑุฉ ุฃุฎุฑู]

// ุฃุซูุงุก ุงูุชุญููู
[โณ ...]

// ูุนุทูู
[๐ ุฅุนุงุฏุฉ ุงูุทูุจ ูุฑุฉ ุฃุฎุฑู] (disabled)
```

---

## ๐ฎ ุชุญุณููุงุช ูุณุชูุจููุฉ (ุงุฎุชูุงุฑูุฉ)

### 1. ุชุนุฏูู ูุจู ุงูุฅุนุงุฏุฉ:
```typescript
// ุงูุณูุงุญ ููุนููู ุจุชุนุฏูู ุงูุชูุงุตูู ูุจู ุงูุฅุนุงุฏุฉ
<TouchableOpacity onPress={() => router.push({
  pathname: '/orders/deliver-package',
  params: { 
    reorderFrom: order.id,
    pickup: order.pickup_address,
    delivery: order.delivery_address,
    fee: order.total_fee
  }
})}>
  <Text>๐ ุฅุนุงุฏุฉ ุงูุทูุจ ูุน ุงูุชุนุฏูู</Text>
</TouchableOpacity>
```

### 2. ุงูุทูุจุงุช ุงููุชูุฑุฑุฉ:
```sql
-- ุนุฏุฏ ูุฑุงุช ุฅุนุงุฏุฉ ุทูุจ ููุณ ุงููุณุงุฑ
SELECT 
  pickup_address,
  delivery_address,
  COUNT(*) as repeat_count
FROM orders 
WHERE customer_id = 'abc123'
GROUP BY pickup_address, delivery_address
HAVING COUNT(*) > 1;
```

### 3. ุงูุชุฑุงุญุงุช ุฐููุฉ:
```typescript
// ุงูุชุฑุงุญ ุงูุทูุจุงุช ุงููุชูุฑุฑุฉ ุนูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
<View>
  <Text>๐ฆ ุทูุจุงุช ูุชูุฑุฑุฉ</Text>
  {frequentOrders.map(order => (
    <TouchableOpacity onPress={() => handleReorder(order)}>
      <Text>{order.pickup_address} โ {order.delivery_address}</Text>
    </TouchableOpacity>
  ))}
</View>
```

### 4. ุงูุทูุจุงุช ุงููุฌุฏููุฉ:
```typescript
// ุงูุณูุงุญ ุจุฌุฏููุฉ ุงูุทูุจ ูููุช ูุงุญู
<TouchableOpacity onPress={() => scheduleReorder(order, scheduledTime)}>
  <Text>๐ ุฅุนุงุฏุฉ ุงูุทูุจ ูู ููุช ูุญุฏุฏ</Text>
</TouchableOpacity>
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ๏ธ ุงูุฃูุงู:
- โ **RLS**: ูุชู ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ูู ุตุงุญุจ ุงูุทูุจ
- โ **Validation**: ูุชู ุงูุชุญูู ูู ุญุงูุฉ ุงูุทูุจ ูุจู ุงูุฅุนุงุฏุฉ
- โ **Error Handling**: ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก

### ๐ ุงูุจูุงูุงุช ุงูููุณูุฎุฉ:
- โ ููุน ุงูุทูุจ (`order_type`)
- โ ุนููุงู ุงูุงุณุชูุงู (`pickup_address`)
- โ ุนููุงู ุงูุชูุตูู (`delivery_address`)
- โ ุงูุฃุฌุฑุฉ (`total_fee`)
- โ ุงูุนูุงุตุฑ (`items`)
- โ ุงููุตู (`package_description`)

### โ ุงูุจูุงูุงุช ุงูุชู ูุง ูุชู ูุณุฎูุง:
- โ ูุนุฑู ุงูุณุงุฆู (`driver_id` = null)
- โ ุญุงูุฉ ุงูุชูุงูุถ (`negotiation_status` = null)
- โ ุงูุฃุณุนุงุฑ ุงูููุชุฑุญุฉ (`driver_proposed_price`, `customer_proposed_price`)
- โ ุงูุญุงูุฉ (`status` = 'pending')
- โ ุชุงุฑูุฎ ุงูุฅูุดุงุก (`created_at` = NOW())

---

## ๐ ูููุงุช ุฐุงุช ุตูุฉ

1. `app/orders/[id].tsx` - ุตูุญุฉ ุชูุงุตูู ุงูุทูุจ (ุชุญุชูู ุนูู ุงูุฒุฑ)
2. `app/(tabs)/customer/my-orders.tsx` - ุตูุญุฉ ุทูุจุงุช ุงูุนููู
3. `components/OrderCard.tsx` - ุจุทุงูุฉ ุนุฑุถ ุงูุทูุจ
4. `lib/notifications.ts` - ูุธุงู ุงูุฅุดุนุงุฑุงุช
5. `create_app_settings.sql` - ุฅุนุฏุงุฏุงุช ุงููุธุงู

---

**โ ุชู ุงูุชุทุจูู ุจูุฌุงุญ! ุงูุขู ุงูุนููู ููููู ุฅุนุงุฏุฉ ุงูุทูุจ ุจุณูููุฉ!** ๐๐











