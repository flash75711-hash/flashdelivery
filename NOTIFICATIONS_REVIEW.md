# ูุฑุงุฌุนุฉ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุจูู ุงูุณุงุฆู ูุงูุนููู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุชูุฑูุฑ ููุญุต ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ ุจูู ุงูุณุงุฆู ูุงูุนููู ูู ุงูุชุทุจูู.

---

## โ ุงูุฅุดุนุงุฑุงุช ุงูููุฌูุฏุฉ ุญุงููุงู

### 1๏ธโฃ **ูู ุงูุนููู ุฅูู ุงูุณุงุฆู**

#### โ ุนูุฏ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
- **ุงููููุน**: `app/orders/outside-order.tsx`, `app/orders/deliver-package.tsx`
- **ุงูุฅุดุนุงุฑ**: ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูุฌููุน ุงูุณุงุฆููู ุงููุดุทูู
- **ุงูููุฏ**: `notifyAllActiveDrivers()`
- **ุงูุญุงูุฉ**: โ ูุนูู

#### โ ุนูุฏ ุฅูุบุงุก ุงูุทูุจ
- **ุงููููุน**: `app/(tabs)/customer/my-orders.tsx`
- **ุงูุฅุดุนุงุฑ**: "ุชู ุฅูุบุงุก ุงูุทูุจ ุฑูู {order_id}"
- **ุงูููุฏ**: `createNotification()` โ `insert_notification_for_driver`
- **ุงูุญุงูุฉ**: โ ูุนูู (ุจุนุฏ ุงูุฅุตูุงุญ)

---

### 2๏ธโฃ **ูู ุงูุณุงุฆู ุฅูู ุงูุนููู**

#### โ ุนูุฏ ูุจูู ุงูุทูุจ
- **ุงููููุน**: 
  - `app/(tabs)/driver/trips.tsx` โ `handleAcceptOrder()`
  - `app/(tabs)/driver/my-orders.tsx` โ `handleAcceptOrder()`
- **ุงูุฅุดุนุงุฑ**: "ุชู ูุจูู ุทูุจู" - "ุชู ูุจูู ุทูุจู ูุณูุชู ุงูุจุฏุก ูู ุงูุชูุตูู ูุฑูุจุงู."
- **ุงูููุฏ**: `supabase.rpc('insert_notification_for_customer_by_driver')`
- **ุงูุญุงูุฉ**: โ ูุนูู

#### โ ุนูุฏ ุฑูุถ ุงูุทูุจ
- **ุงููููุน**: `app/(tabs)/driver/my-orders.tsx` โ `handleCancelOrder()`
- **ุงูุฅุดุนุงุฑ**: "ุชู ุฑูุถ ุงูุทูุจ" - "ุชู ุฑูุถ ุงูุทูุจ ูู ูุจู ุงูุณุงุฆู. ุณูุชู ุงูุจุญุซ ุนู ุณุงุฆู ุขุฎุฑ."
- **ุงูููุฏ**: `createNotification()`
- **ุงูุญุงูุฉ**: โ ูุนูู

#### โ ุนูุฏ ุจุฏุก ุงูุชูุงูุถ
- **ุงููููุน**: `components/OrderCard.tsx` โ `handleStartNegotiation()`
- **ุงูุฅุดุนุงุฑ**: "ุจุฏุก ุงูุชูุงูุถ" - "ุงูุณุงุฆู ูุจู ุงูุทูุจ ูุจุฏุฃ ุงูุชูุงูุถ ุนูู ุงูุณุนุฑ"
- **ุงูููุฏ**: `createNotification()`
- **ุงูุญุงูุฉ**: โ ูุนูู

#### โ ุนูุฏ ุงูุชุฑุงุญ ุงูุณุงุฆู ุณุนุฑ ุฌุฏูุฏ
- **ุงููููุน**: `components/OrderCard.tsx` โ `handleProposePrice()`
- **ุงูุฅุดุนุงุฑ**: "ุงูุชุฑุงุญ ุณุนุฑ ุฌุฏูุฏ" - "ุงูุชุฑุญ ุงูุณุงุฆู ุณุนุฑ ุฌุฏูุฏ: {price} ุฌ.ู"
- **ุงูููุฏ**: `createNotification()`
- **ุงูุญุงูุฉ**: โ ูุนูู

#### โ ุนูุฏ ูุจูู ุงูุณุงุฆู ุงูุชุฑุงุญ ุงูุนููู
- **ุงููููุน**: `components/OrderCard.tsx` โ `handleDriverAcceptCustomerProposal()`
- **ุงูุฅุดุนุงุฑ**: "ุชู ูุจูู ุงูุชุฑุงุญู" - "ุชู ูุจูู ุงูุชุฑุงุญู ููุณุนุฑ {price} ุฌ.ู"
- **ุงูููุฏ**: `createNotification()`
- **ุงูุญุงูุฉ**: โ ูุนูู

---

### 3๏ธโฃ **ูู ุงูุนููู ุฅูู ุงูุณุงุฆู (ูู ุงูุชูุงูุถ)**

#### โ ุนูุฏ ูุจูู ุงูุนููู ุงูุชุฑุงุญ ุงูุณุงุฆู
- **ุงููููุน**: `components/OrderCard.tsx` โ `handleAcceptProposal()`
- **ุงูุฅุดุนุงุฑ**: "ุชู ูุจูู ุงูุชุฑุงุญู" - "ุชู ูุจูู ุงูุชุฑุงุญู ููุณุนุฑ {price} ุฌ.ู"
- **ุงูููุฏ**: `createNotification()`
- **ุงูุญุงูุฉ**: โ ูุนูู

#### โ ุนูุฏ ุงูุชุฑุงุญ ุงูุนููู ุณุนุฑ ุฌุฏูุฏ
- **ุงููููุน**: `components/OrderCard.tsx` โ `handleCustomerProposePrice()`
- **ุงูุฅุดุนุงุฑ**: "ุงูุชุฑุงุญ ุณุนุฑ ุฌุฏูุฏ ูู ุงูุนููู" - "ุงูุชุฑุญ ุงูุนููู ุณุนุฑ ุฌุฏูุฏ: {price} ุฌ.ู"
- **ุงูููุฏ**: `createNotification()`
- **ุงูุญุงูุฉ**: โ ูุนูู

---

## โ ุงูุฅุดุนุงุฑุงุช ุงูููููุฏุฉ

### 1๏ธโฃ **ุนูุฏ ุงุณุชูุงู ุงูุทูุจ (Picked Up)**
- **ุงููุดููุฉ**: ูุง ููุฌุฏ ุฅุดุนุงุฑ ููุนููู ุนูุฏ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู `pickedUp`
- **ุงููููุน ุงููุชููุน**: `app/driver/track-trip.tsx`
- **ุงูุญุงูุฉ ุงูุญุงููุฉ**: 
  - ุงูุณุงุฆู ูุญุฏูุซ `order_items.is_picked_up` ููุท
  - ูุง ูุชู ุชุญุฏูุซ `order.status` ุฅูู `pickedUp`
  - ูุง ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุนููู

### 2๏ธโฃ **ุนูุฏ ุจุฏุก ุงูุชูุตูู (In Transit)**
- **ุงููุดููุฉ**: ูุง ููุฌุฏ ุฅุดุนุงุฑ ููุนููู ุนูุฏ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู `inTransit`
- **ุงูุญุงูุฉ ุงูุญุงููุฉ**: 
  - ูุง ููุฌุฏ ููุฏ ูุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู `inTransit`
  - ูุง ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุนููู

### 3๏ธโฃ **ุนูุฏ ุฅููุงู ุงูุทูุจ (Completed)**
- **ุงููุดููุฉ**: ูุง ููุฌุฏ ุฅุดุนุงุฑ ููุนููู ุนูุฏ ุฅููุงู ุงูุทูุจ
- **ุงูุญุงูุฉ ุงูุญุงููุฉ**: 
  - ูุง ููุฌุฏ ููุฏ ูุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู `completed` ูู `track-trip.tsx`
  - ูุง ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุนููู

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. **useOrderNotifications Hook**
- **ุงููููุน**: `hooks/useOrderNotifications.ts`
- **ุงููุธููุฉ**: ูุนุฑุถ ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ (Web ููุท)
- **ุงูุฅุดุนุงุฑุงุช ุงููุนุฑูุถุฉ**:
  - `accepted`: "ุชู ูุจูู ุทูุจู"
  - `pickedUp`: "ุชู ุงุณุชูุงู ุงูุทูุจ"
  - `inTransit`: "ุงูุทูุจ ููุฏ ุงูุชูุตูู"
  - `completed`: "ุชู ุฅููุงู ุงูุทูุจ"
  - `cancelled`: "ุชู ุฅูุบุงุก ุงูุทูุจ"
- **ุงููุดููุฉ**: ูุฐู ุงูุฅุดุนุงุฑุงุช ุชุนุชูุฏ ุนูู Realtime ููุทุ ููุง ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. **ุฅุดุนุงุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช vs Realtime**
- **ุงูุฅุดุนุงุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ูุชู ุฅุฑุณุงููุง ุนุจุฑ `createNotification()` ูุชุธูุฑ ูู `NotificationCard`
- **ุงูุฅุดุนุงุฑุงุช Realtime**: ุชุธูุฑ ููุท ูู `FloatingNotification` (Web ููุท)
- **ุงููุดููุฉ**: ูุฏ ูุง ูุฑู ุงููุณุชุฎุฏู ุงูุฅุดุนุงุฑุงุช ุฅุฐุง ูู ููู ุนูู Web

---

## ๐๏ธ ุงูุชูุตูุงุช ููุฅุตูุงุญ

### 1. ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ููุญุงูุงุช ุงูููููุฏุฉ

#### ุฃ. ุนูุฏ ุงุณุชูุงู ุงูุทูุจ (Picked Up)
```typescript
// ูู app/driver/track-trip.tsx
const handleMarkOrderAsPickedUp = async () => {
  // ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
  await supabase.functions.invoke('update-order', {
    body: {
      orderId: order.id,
      status: 'pickedUp',
    },
  });
  
  // ุฅุดุนุงุฑ ุงูุนููู
  if (order.customer_id) {
    await createNotification({
      user_id: order.customer_id,
      title: 'ุชู ุงุณุชูุงู ุงูุทูุจ',
      message: 'ุชู ุงุณุชูุงู ุทูุจู ูู ูุจู ุงูุณุงุฆู ููู ูู ุงูุทุฑูู ุฅููู.',
      type: 'info',
      order_id: order.id,
    });
  }
};
```

#### ุจ. ุนูุฏ ุจุฏุก ุงูุชูุตูู (In Transit)
```typescript
// ุชุญุฏูุซ ุชููุงุฆู ุจุนุฏ pickedUp
// ุฃู ุฒุฑ ูุฏูู ูู track-trip.tsx
const handleMarkAsInTransit = async () => {
  await supabase.functions.invoke('update-order', {
    body: {
      orderId: order.id,
      status: 'inTransit',
    },
  });
  
  // ุฅุดุนุงุฑ ุงูุนููู
  if (order.customer_id) {
    await createNotification({
      user_id: order.customer_id,
      title: 'ุงูุทูุจ ููุฏ ุงูุชูุตูู',
      message: 'ุทูุจู ูู ุงูุทุฑูู ุฅููู ุงูุขู.',
      type: 'info',
      order_id: order.id,
    });
  }
};
```

#### ุฌ. ุนูุฏ ุฅููุงู ุงูุทูุจ (Completed)
```typescript
// ูู app/driver/track-trip.tsx
const handleMarkAsCompleted = async () => {
  await supabase.functions.invoke('update-order', {
    body: {
      orderId: order.id,
      status: 'completed',
      completedAt: new Date().toISOString(),
    },
  });
  
  // ุฅุดุนุงุฑ ุงูุนููู
  if (order.customer_id) {
    await createNotification({
      user_id: order.customer_id,
      title: 'ุชู ุฅููุงู ุงูุทูุจ',
      message: 'ุชู ุฅููุงู ุทูุจู ุจูุฌุงุญ. ุดูุฑุงู ูุงุณุชุฎุฏุงูู Flash Delivery!',
      type: 'success',
      order_id: order.id,
    });
  }
};
```

### 2. ุชูุญูุฏ ุงูุฅุดุนุงุฑุงุช
- **ุงููุดููุฉ**: ุจุนุถ ุงูุฅุดุนุงุฑุงุช ุชุณุชุฎุฏู `createNotification()` ูุจุนุถูุง ูุณุชุฎุฏู `supabase.rpc()` ูุจุงุดุฑุฉ
- **ุงูุญู**: ุชูุญูุฏ ุงุณุชุฎุฏุงู `createNotification()` ูู ุฌููุน ุงูุฃูุงูู

### 3. ุฅุฒุงูุฉ console.log
- **ุงููููุน**: `app/(tabs)/driver/trips.tsx`
- **ุงูุฅุดุนุงุฑุงุช**: ููุฌุฏ console.log ูู `handleAcceptOrder()`
- **ุงูุญู**: ุฅุฒุงูุฉ console.log ุบูุฑ ุงูุถุฑูุฑูุฉ

---

## ๐ ููุฎุต ุงูุฅุดุนุงุฑุงุช

| ุงูุญุงูุฉ | ูู | ุฅูู | ููุฌูุฏุฉุ | ููุงุญุธุงุช |
|--------|-----|-----|---------|---------|
| ุฅูุดุงุก ุทูุจ | ุนููู | ุณุงุฆููู | โ | ูุนูู |
| ูุจูู ุทูุจ | ุณุงุฆู | ุนููู | โ | ูุนูู |
| ุฑูุถ ุทูุจ | ุณุงุฆู | ุนููู | โ | ูุนูู |
| ุจุฏุก ุชูุงูุถ | ุณุงุฆู | ุนููู | โ | ูุนูู |
| ุงูุชุฑุงุญ ุณุนุฑ (ุณุงุฆู) | ุณุงุฆู | ุนููู | โ | ูุนูู |
| ุงูุชุฑุงุญ ุณุนุฑ (ุนููู) | ุนููู | ุณุงุฆู | โ | ูุนูู |
| ูุจูู ุงูุชุฑุงุญ (ุนููู) | ุนููู | ุณุงุฆู | โ | ูุนูู |
| ูุจูู ุงูุชุฑุงุญ (ุณุงุฆู) | ุณุงุฆู | ุนููู | โ | ูุนูู |
| ุงุณุชูุงู ุทูุจ (pickedUp) | ุณุงุฆู | ุนููู | โ | **ููููุฏ** |
| ุจุฏุก ุชูุตูู (inTransit) | ุณุงุฆู | ุนููู | โ | **ููููุฏ** |
| ุฅููุงู ุทูุจ (completed) | ุณุงุฆู | ุนููู | โ | **ููููุฏ** |
| ุฅูุบุงุก ุทูุจ (ุนููู) | ุนููู | ุณุงุฆู | โ | ูุนูู (ุจุนุฏ ุงูุฅุตูุงุญ) |
| ุฅูุบุงุก ุทูุจ (ุณุงุฆู) | ุณุงุฆู | ุนููู | โ | ูุนูู |

---

## ๐ฏ ุงูุฃููููุงุช ููุฅุตูุงุญ

1. **ุนุงุฌู**: ุฅุถุงูุฉ ุฅุดุนุงุฑ ุนูุฏ ุฅููุงู ุงูุทูุจ (completed)
2. **ููู**: ุฅุถุงูุฉ ุฅุดุนุงุฑ ุนูุฏ ุงุณุชูุงู ุงูุทูุจ (pickedUp)
3. **ููู**: ุฅุถุงูุฉ ุฅุดุนุงุฑ ุนูุฏ ุจุฏุก ุงูุชูุตูู (inTransit)
4. **ุชุญุณูู**: ุชูุญูุฏ ุงุณุชุฎุฏุงู `createNotification()`
5. **ุชูุธูู**: ุฅุฒุงูุฉ console.log ุบูุฑ ุงูุถุฑูุฑูุฉ

---

**ุชุงุฑูุฎ ุงููุฑุงุฌุนุฉ**: $(date)
**ุงูุญุงูุฉ**: โ๏ธ ูุญุชุงุฌ ุฅุตูุงุญุงุช

